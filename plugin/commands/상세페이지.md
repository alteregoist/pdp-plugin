---
description: 상품 이미지/정보로 상세페이지 자동 생성
allowed-tools: Read, Write, Edit, Bash, Glob, Grep, Task, AskUserQuestion, TodoWrite, WebFetch, mcp__fal-ai__*
argument-hint: [상품명 또는 상품 이미지 경로]
---

상품 상세페이지를 자동 생성한다.

## 실행 순서

### Step 1: 스킬 및 참조 파일 로드

먼저 다음 파일들을 읽어 도메인 지식을 로드한다:
- `${CLAUDE_PLUGIN_ROOT}/skills/detail-page-generator/SKILL.md`
- `${CLAUDE_PLUGIN_ROOT}/skills/detail-page-generator/references/modules/common.md`
- `${CLAUDE_PLUGIN_ROOT}/skills/detail-page-generator/references/modules/{플랫폼명}.md` (선택된 플랫폼별로 로드)
- `${CLAUDE_PLUGIN_ROOT}/skills/detail-page-generator/references/platform-configs.md`
- `${CLAUDE_PLUGIN_ROOT}/skills/detail-page-generator/references/copywriting-guide.md`
- `${CLAUDE_PLUGIN_ROOT}/skills/detail-page-generator/references/image-generation.md`

### Step 2: 이미지 수집 (최우선 작업)

**다른 어떤 작업보다 먼저** 사용 가능한 이미지를 확인하고 보관한다.

아래 순서로 확인한다:

**① 이미지 URL 직접 제공 (최우선)**
사용자가 `https://...` 형태의 이미지 URL을 제공한 경우:
- URL을 `image_log.json`의 `source_urls`에 기록한다
- fal.ai 모델에 `image_url` 파라미터로 직접 전달하므로 별도 업로드 불필요
- 여러 URL이면 모두 수집하고 모듈별 용도를 파악한다

**② 작업 폴더의 이미지 파일**
사용자가 선택한 작업 폴더에서 이미지 파일을 검색한다 (`find` 또는 `Glob`):
- 이미지가 있으면 → `originals/` 폴더로 복사 후 `mcp__fal-ai__upload`로 CDN URL 확보
- `image_log.json`의 `uploaded_originals`에 기록

**③ 채팅에 첨부된 이미지 — 사용 불가**
Cowork 채팅에 붙여넣기/드래그한 이미지는 파일 시스템에 저장되지 않아 직접 활용이 불가능하다.
이 경우 사용자에게 다음과 같이 안내하고 ①②로 유도한다:

> "채팅에 첨부된 이미지는 직접 사용할 수 없습니다. 아래 방법 중 하나를 이용해 주세요:
> - **이미지 URL 붙여넣기** — 상품 이미지의 웹 주소(https://...)를 채팅에 입력해 주세요
> - **작업 폴더에 파일 저장** — 이미지 파일을 선택하신 작업 폴더에 넣어주시면 바로 사용합니다"

### Step 3: 상품 정보 수집

사용자에게 다음을 AskUserQuestion으로 확인한다:

1. **상품명** — 인자($ARGUMENTS)로 전달되었다면 그대로 사용
2. **상품 카테고리** — 식품/가전/생활용품/패션/건강 중 선택
3. **대상 플랫폼** — 롯데마트몰/쿠팡/네이버 스마트스토어/11번가 중 **복수 선택 가능** (`multiSelect: true`)
   - 여러 플랫폼을 선택하면 각 플랫폼별 상세페이지를 동시에 생성한다
4. **핵심 특장점** — 3~5개 입력 요청

Step 2에서 이미지를 저장했다면, 저장된 이미지를 분석하여 상품 정보(상품명, 카테고리, 특장점 등)를 최대한 자동 추출하고, 부족한 정보만 추가로 질문한다.

### Step 4: SKILL.md의 워크플로우 수행

SKILL.md에 정의된 Core Workflow를 순서대로 수행한다.

**멀티 플랫폼 처리 원칙**:
- 이미지 수집·카피라이팅 등 **공통 작업(Step 1~5)은 한 번만** 수행한다
- 공통 작업 완료 후, 플랫폼별 HTML 빌드 + Playwright 캡처는 **Task 도구로 병렬 실행**한다
  - 선택된 플랫폼 수만큼 Task를 **단일 메시지에 동시 호출**한다
  - 각 Task에 카피·이미지 매핑·플랫폼 규격을 프롬프트로 전달한다
- SKILL.md Step 6의 "복수 플랫폼 — 병렬 처리" 섹션을 참고한다

**이미지 활용 원칙** (SKILL.md Step 5 및 image-generation.md 참고):
1. **원본 이미지 우선**: `originals/`에 저장된 첨부 이미지를 상세페이지에 최대한 활용한다
2. **첨부 이미지 기반 편집**: 원본만으로 부족한 경우, 첨부 이미지를 참고하여 image-to-image로 변형/확장한다
3. **text-to-image 생성**: 위 두 방법으로도 커버되지 않는 이미지는 text-to-image로 새로 생성한다

### Step 5: 출력

작업 디렉토리에 결과물을 생성하고 사용자에게 링크를 제공한다:
- 플랫폼별 HTML 파일
- 플랫폼별 전체 페이지 이미지 (PNG)
- 플랫폼별 개별 모듈 이미지 (PNG)
- 공통 이미지 파일들 (originals, generated)

### 주의사항

- Playwright 설치가 안 되어 있으면 자동으로 설치한다 (`npm install playwright && npx playwright install chromium`)
- fal.ai MCP 도구는 `mcp__fal-ai__generate`, `mcp__fal-ai__result` 등의 이름 패턴으로 사용한다. 이 도구들이 사용 가능한지 확인하여 MCP 연결 상태를 판단한다.
- fal.ai MCP가 연결되지 않으면 사용자에게 FAL_KEY 환경변수 설정 및 플러그인 재설치를 안내한다
- 이미지 생성 실패 시 플레이스홀더 이미지를 사용하고 사용자에게 알린다
- 모든 생성된 파일은 사용자 접근 가능한 출력 폴더에 저장한다
